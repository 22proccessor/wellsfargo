var initializeInitialInputForm=function(){$("#purchasePrice, #downPaymentAmount, #downPaymentPercent,#buyNewHome #newAnnualRealEstateTaxes,#buyNewHome #newAnnualRealEstateTaxesPercent,#currentFinancingInfo #newAnnualRealEstateTaxes,#currentFinancingInfo #newAnnualRealEstateTaxesPercent").focus(function(){window.wfOnFocusVals[this.id]=this.value;});};function isValidNumber(str){str+="";if(str.indexOf("-")>-1){return false;}return !isNaN(parseFloat(str.replace(/,/g,"")));}function addCommas(num){if(num){num=parseInt(num,10);num+="";return num.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");}else{return num;}}function formatCurrency(num,considerzero){if(!considerzero||typeof(considerzero)=="undefined"){if(num==""&&num!=0){return;}}else{if(considerzero){if(num==""){return;}}}num=num+" ";num=num.replace(/[^0-9\-.]/g,"");if(num.indexOf("-")>-1){var arr=num.split("-");for(var i=0;i<arr.length;i++){arr[i]=addCommas(Math.round(arr[i]));}num=arr.join(" - ");}else{num=Math.round(num);num=addCommas(num);}return num;}function formatDownPaymentPercentage(num,roundTo){roundTo=(!roundTo)?0:roundTo;if(!isValidNumber(num)){return num;}return(num*100).toFixed(3);}function autoCalculatePaymentPercentage(trigger,price,amount,percentage,round,twodec,noreversecal){if(window.wfOnFocusVals[trigger.id]==trigger.value){return;}trigger=$(trigger);switch(trigger.attr("id")){case price.attr("id"):if(!noreversecal){if(!isValidNumber(trigger.val())&&!parseFloat(trigger.val())){if(isValidNumber(amount.val())&&(parseFloat(amount.val())!==false)){amount.val("");}else{if(isValidNumber(percentage.val())&&(parseFloat(percentage.val())!==false)){percentage.val("");}}}}if(isValidNumber(trigger.val())&&(parseFloat(trigger.val())!==false)){if(isValidNumber(amount.val())&&(parseFloat(amount.val())!==false)){val=formatDownPaymentPercentage(amount.val().replace(/[^0-9\.-]/g,"")/trigger.val().replace(/[^0-9\.-]/g,""));if((amount.val()==0||amount.val()!=0)&&trigger.val()==0){val=formatDownPaymentPercentage(trigger.val().replace(/[^0-9\.-]/g,""));amount.val(trigger.val().replace(/[^0-9\.-]/g,""));}if(round){val=parseFloat(val).toFixed(0);}if(twodec){val=parseFloat(val).toFixed(2);}percentage.val(val);}else{if(isValidNumber(percentage.val())&&(parseFloat(percentage.val())!==false)){amount.val(formatCurrency(trigger.val().replace(/[^0-9\.-]/g,"")*(percentage.val().replace(/[^0-9\.-]/g,"")/100)));}}trigger.val(formatCurrency(trigger.val().replace(/[^0-9\.-]/g,"")));}break;case amount.attr("id"):if(!noreversecal){if(!isValidNumber(trigger.val())&&!parseFloat(trigger.val())){if(isValidNumber(price.val())&&(parseFloat(price.val())!==false)&&isValidNumber(percentage.val())&&(parseFloat(percentage.val())!==false)){trigger.val(formatCurrency(price.val().replace(/[^0-9\.-]/g,"")*(percentage.val().replace(/[^0-9\.-]/g,"")/100)));}else{if(isValidNumber(percentage.val())&&(parseFloat(percentage.val()))!==false){price.val(formatCurrency(trigger.val().replace(/[^0-9\.-]/g,"")/(percentage.val().replace(/[^0-9\.-]/g,"")/100)));}}}}if(isValidNumber(trigger.val())&&(parseFloat(trigger.val())!==false)){if(isValidNumber(price.val())&&(parseFloat(price.val())!==false)){val=formatDownPaymentPercentage(trigger.val().replace(/[^0-9\.-]/g,"")/price.val().replace(/[^0-9\.-]/g,""));if((trigger.val()==0||trigger.val()!=0)&&price.val()==0){val=formatDownPaymentPercentage(price.val().replace(/[^0-9\.-]/g,""));trigger.val(price.val().replace(/[^0-9\.-]/g,""));}if(round){val=parseFloat(val).toFixed(0);}if(twodec){val=parseFloat(val).toFixed(2);}percentage.val(val);}else{if(isValidNumber(percentage.val())&&(parseFloat(percentage.val())!==false)){price.val(formatCurrency(trigger.val().replace(/[^0-9\.-]/g,"")/(percentage.val().replace(/[^0-9\.-]/g,"")/100)));}}trigger.val(formatCurrency(trigger.val().replace(/[^0-9\.-]/g,"")));}break;case percentage.attr("id"):if(!noreversecal){if(!isValidNumber(trigger.val())&&!parseFloat(trigger.val())){if(isValidNumber(price.val())&&(parseFloat(price.val())!==false)&&isValidNumber(amount.val())&&(parseFloat(amount.val())!==false)){val=formatDownPaymentPercentage(amount.val().replace(/[^0-9\.-]/g,"")/price.val().replace(/[^0-9\.-]/g,""));if((amount.val()==0||amount.val()!=0)&&price.val()==0){val=formatDownPaymentPercentage(price.val().replace(/[^0-9\.-]/g,""));amount.val(price.val().replace(/[^0-9\.-]/g,""));}if(round){val=parseFloat(val).toFixed(0);}if(twodec){val=parseFloat(val).toFixed(2);}trigger.val(val);}else{if(isValidNumber(amount.val())&&(parseFloat(amount.val())!==false)){price.val(formatCurrency(amount.val().replace(/[^0-9\.-]/g,"")/(trigger.val().replace(/[^0-9\.-]/g,"")/100)));}}}}if(isValidNumber(trigger.val())&&(parseFloat(trigger.val())!==false)){val=formatDownPaymentPercentage(trigger.val()/100);if(round){val=parseFloat(val).toFixed(0);}if(twodec){val=parseFloat(val).toFixed(2);}trigger.val(val);if(isValidNumber(price.val())&&(parseFloat(price.val())!==false)){amount.val(formatCurrency(price.val().replace(/[^0-9\.-]/g,"")*(trigger.val().replace(/[^0-9\.-]/g,"")/100)));}else{if(isValidNumber(amount.val())&&(parseFloat(amount.val())!==false)){price.val(formatCurrency(amount.val().replace(/[^0-9\.-]/g,"")/(trigger.val().replace(/[^0-9\.-]/g,"")/100)));}}}break;}}var catchShiftFixIE=function(e){if(e.keyCode!==16){if(e.keyCode==36||e.keyCode==9||e.keyCode==37||e.keyCode==39||e.keyCode==8||e.keyCode==46||(e.keyCode>=48&&e.keyCode<=57)||(e.keyCode>=96&&e.keyCode<=105)){$(this).select();return true;}else{return false;}}};var initMainPageAfterLoad=function(){$(document).on("blur","#purchasePrice, #downPaymentAmount, #downPaymentPercent",function(){autoCalculatePaymentPercentage(this,$("#purchasePrice"),$("#downPaymentAmount"),$("#downPaymentPercent"),true,false,false);});$(document).on("blur","#purchasePrice, #buyNewHome #newAnnualRealEstateTaxes, #buyNewHome #newAnnualRealEstateTaxesPercent",function(){autoCalculatePaymentPercentage(this,$("#purchasePrice"),$("#buyNewHome #newAnnualRealEstateTaxes"),$("#buyNewHome #newAnnualRealEstateTaxesPercent"),false,true,true);});$(document).on("blur","#estimatedValueOfHome, #currentFinancingInfo #newAnnualRealEstateTaxes, #currentFinancingInfo #newAnnualRealEstateTaxesPercent",function(){autoCalculatePaymentPercentage(this,$("#estimatedValueOfHome"),$("#currentFinancingInfo #newAnnualRealEstateTaxes"),$("#currentFinancingInfo #newAnnualRealEstateTaxesPercent"),false,true,true);});$(document).on("blur","#estimatedValueOfHome, #buyNewHome #newAnnualRealEstateTaxes, #buyNewHome #newAnnualRealEstateTaxesPercent",function(){autoCalculatePaymentPercentage(this,$("#estimatedValueOfHome"),$("#buyNewHome #newAnnualRealEstateTaxes"),$("#buyNewHome #newAnnualRealEstateTaxesPercent"),false,true,true);});$(document).on("blur","#annualHomeownersInsurance, #totalExistingMortgageBalance, #totalCurrentMonthlyPayment, #additionalFundsNeeded",function(){$(this).val(formatCurrency(($(this).val()),true));});$("input").on("keyup",function(e){catchShiftFixIE(e);});$(".currency").on("keyup",function(e){if(catchShiftFixIE(e)){return;}var val=$(this).val().replace(/[^0-9,]/g,"");$(this).val(val);});$(".percentage").on("keyup",function(e){if(catchShiftFixIE(e)){return;}var val=$(this).val().replace(/[^0-9.]/g,"");var indexOfDot=val.indexOf(".");var scrubbed="";if(indexOfDot>-1){scrubbed=val.replace(/[^0-9]/g,"");val=scrubbed.slice(0,indexOfDot)+"."+scrubbed.slice(indexOfDot);}var lowLimit=($(this))?0:0.001;val=(val<lowLimit||val>100)?"":val;$(this).val(val);});};function processEmailRequest(formObj){var url=formObj.action;var svgObjHtmlArray=[];if($(".highcharts-container").length>0){$(".highcharts-container").each(function(index,value){var chartid=$(this).attr("id");var chartObj=document.getElementById(chartid);var svgObj=chartObj.getElementsByTagName("svg")[0];var svgObjHtml=$(svgObj).outerHTML();var q="&quot;";var re=new RegExp(q,"g");svgObjHtml=svgObjHtml.replace(re,"");var amp="&amp;";var reamp=new RegExp(amp,"g");svgObjHtml=svgObjHtml.replace(reamp,"#38;");var rgbavalue;var path=chartObj.getElementsByTagName("path");
if(svgObjHtml.indexOf("rgba")!=-1){$(path).each(function(index){var a=$(this).attr("fill");if(a.indexOf("rgba")!=-1){rgbavalue=$(this).attr("fill");var s=rgbavalue.substring(rgbavalue.lastIndexOf(","),rgbavalue.length-1);var re1=new RegExp(s,"g");svgObjHtml=svgObjHtml.replace(re1,"");}});var find="rgba";var re=new RegExp(find,"g");svgObjHtml=svgObjHtml.replace(re,"rgb");}svgObjHtmlArray.push("&svg="+encodeURIComponent(svgObjHtml));});}var chkBoxArray=[];$("#compareResultsList input[name=pctId]:checked").each(function(){chkBoxArray.push("pctId="+$(this).val());});var formData=$(formObj).serialize()+"&"+((typeof loadChartId!=="undefined"&&parseInt(loadChartId)>0)?"pctId="+loadChartId:chkBoxArray.join("&"));$.ajax({"type":formObj.method,"url":url,"data":formData,"beforeSend":function(xhr){},"success":function(data){try{receivedEmailResponse(data);}catch(err){Utility.ajaxLog(err);}},"error":function(xhr,code,status){Utility.ajaxLog({"message":"AJAX request to "+url+" failed with: "+code+" "+xhr.status+" "+xhr.statusText});noResults(true);}}).always(function(data,textStatus,errorThrown){enableDisabledSubmitButton();clearLoadingAfterProcessing();});setSessionTimer();}function receivedEmailResponse(data){data=untaintAndParse(data);if(hasError(data)){if(data.status!="failed"){handleAjaxError(data);return;}}showEmailResultSuccessPopup();return true;}function updateLoanDetails(formObj){var formData="";formData=$(formObj).serialize();formData=formData+"&pctPageName=yourLoanDetails";if($("#siteSuffix").length){formData+="&siteSuffix="+$("#siteSuffix").val();}clearErrorMarkers();var url="/as/forms/pct/loanDetails";$.ajax({"type":"post","url":url,"data":formData,"success":function(data){try{processUpdateLoanDetailsResponse(data,formObj);}catch(err){Utility.ajaxLog(err);}},"error":function(xhr,code,status){Utility.ajaxLog({"message":"AJAX request to "+url+" failed with: "+code+" "+xhr.status+" "+xhr.statusText});noResults(true);}}).always(function(data,textStatus,errorThrown){enableDisabledSubmitButton();clearLoadingAfterProcessing();});}function processUpdateLoanDetailsResponse(jsonObj,formObj){jsonObj=untaintAndParse(jsonObj);if(hasError(jsonObj)){handleAjaxError(jsonObj);$(document).on("click","#c28lightbox .a28close",function(evt){if($(this).closest("#c28lightbox").find("form  #messageBox .errorHeadline").length>0){window.location.reload();}});return;}window.location.href=$(formObj).attr("action");}function handleAjaxError(jsonObj){if(jsonObj.redirectUrl){window.location.href=jsonObj.redirectUrl;return;}if(jsonObj.errorMessage){showMessageBox("error",jsonObj.errorMessage);}if(jsonObj.informationalMessage){showMessageBox("info",jsonObj.informationalMessage);}if(jsonObj.warningMessage){showMessageBox("alert",jsonObj.warningMessage);}if(typeof jsonObj.data!=="undefined"&&jsonObj.data.invalidFields){var mbox=$("#messageBox");if(!jsonObj.errorMessage){showMessageBox("error","Please correct the highlighted information below.");}var htmlWithErrorText="";jQuery.each(jsonObj.data.invalidFields,function(index,fname){var elem_id=fname;if(elem_id.search(/^[a-z]+$/)!=-1){elem_id="newProperty"+ucfirst(elem_id);}if($("#"+elem_id+"Sham").length){elem_id+="Sham";}if($("#"+elem_id).length){$("#"+elem_id).addClass("erroneous");$("#"+elem_id).siblings(".append-error-message").show();if($("label[for="+elem_id+"]").length>0){if($("label[for="+elem_id+"]").hasClass("hidden")===false){$("label[for="+elem_id+"]").addClass("error");}else{$("#"+elem_id).closest("div.requiredContainer").find("label.required, h3.required, div.required").addClass("error");$("#"+elem_id).closest("div.requiredContainer").find("input.required, select.required").attr("aria-required",true);}$("label[for="+elem_id+"]").prepend('<span class="ui-hidden-accessible errorText">Error</span>');}if(elem_id.search(/County/)!=-1){if($("label[for="+elem_id.replace(/County/,"State")+"]").length){$("label[for="+elem_id.replace(/County/,"State")+"]").addClass("erroneous");}}if($("#"+elem_id).parents("fieldset").length){$("#"+elem_id).parents("fieldset").find("legend").addClass("erroneous");}}});mbox.show({complete:function(){$(this).attr("aria-hidden","false");}});if(mbox.length>0){enableDisabledSubmitButton();clearLoadingAfterProcessing();scrollToElement(mbox);}}}function showLoadingForProcessing(){fixLoadingOverlayPosition();$("#loadingOverlay").show();$("#loadingDialog").show();}function clearLoadingAfterProcessing(){$("#loadingOverlay").hide();$("#loadingDialog").hide();}function enableDisabledSubmitButton(){$("input[type='submit']").prop("disabled",false);}function isValidEmail(emailValue){var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var email="";var tempEmail=[];tempEmail=emailValue.split(",");if(tempEmail.length>3){return false;}for(var i=0;i<tempEmail.length;i++){email=$.trim(tempEmail[i]);if(!filter.test(email)){return false;}}return true;}function ucfirst(str){return str.substr(0,1).toUpperCase()+str.substr(1);}function showHideGenerateChartButton(){if($(".aResult.resultSelected").length<4&&(($(".currentMortgage .currentMortgageContent").length>0&&$(".aResult.resultSelected").length>=1)||$(".aResult.resultSelected").length>1)){$("#slideshow").hide();$(".chartsContainer").show();$("#chartgeneration").removeClass("secondarybtn").addClass("utilitybtn");}else{$("#slideshow").hide();$(".chartsContainer").show();$("#chartgeneration").addClass("secondarybtn").removeClass("utilitybtn");}$("#chartTitle").html("");}var removedFromPage=[];function removeFromPageOnLoad(){$(".removeFromPage").each(function(index){removedFromPage[$(this).attr("id")]=$(this).removeClass("removeFromPage").clone(true).css("display","block");$(this).remove();});}function getRemovedFromPage(elemID){if(typeof removedFromPage[elemID]!=="undefined"){return removedFromPage[elemID];}return null;}function submitHiddenForm(){var hiddenForm=$("form#rcfPrefillForm");if(hiddenForm.length){$(".c10 a.c7").on("click",function(e){e.preventDefault();hiddenForm.submit();});}}var svgTitle=[];$(document).ready(function(){window.WF_SESSION=window.WF_SESSION||{};if(typeof window.WF_SESSION.keepAlive!=="function"){window.WF_SESSION.keepAlive=function(){continueUserSession();};}initializeInitialInputForm();initMainPageAfterLoad();showHideGenerateChartButton();removeFromPageOnLoad();submitHiddenForm();$(".c28aLink,.c28cLink").on("click",function(){$(".c29content[aria-hidden=false] .c29close a").trigger("click");setSessionTimer();});$(".expandAddOption").on("click",function(){$(".addoptionContainer").slideToggle();$(".expandAddOption span").toggleClass("collapse");setSessionTimer();});$(".credentialsInfo").on("click",function(){$(".credentialForm").slideToggle();$(".credentialsInfo span").toggleClass("collapseCredentials");setSessionTimer();});$(".selectResult input:checkbox").prop("checked",false);$(document).on("change","input:checkbox",function(e){$(this).toggleClass("checked");setSessionTimer();});$(document).on("click",".modalContent form  input:checkbox",function(e){setSessionTimer();if($(".modalContent form  input[type='checkbox']:checked").length>2){alert("You may select up to two items. To select this item, please deselect one of the others.");e.preventDefault();return false;}});$(document).on("click","#refineIncludeLoanTypes input:checkbox",function(evt){if($("#refineIncludeLoanTypes input:checkbox:checked").length>2){alert("You may select up to two items. To select this item, please deselect one of the others.");evt.preventDefault();}setSessionTimer();});$(".selectResult input:checkbox").on("change",function(e){if($(".selectResult input[type='checkbox']:checked").length>3){alert("You cannot select more than 3 check boxes.");$(this).prop("checked",false);e.preventDefault();return false;}if($(this).closest("li").hasClass("resultSelected")){$(this).closest("li").removeClass("resultSelected");}else{$(this).closest("li").addClass("resultSelected");}showHideGenerateChartButton();setSessionTimer();});$("#chartgeneration").on("click",function(){if($(this).hasClass("secondarybtn")){return false;
}else{$(this).parent().parent().hide();$("#slideshow").show();}loadChart("/as/forms/pct/generateResultsChart");setSessionTimer();});if(typeof chartLoad!=="undefined"&&chartLoad===true){loadChart("/as/forms/pct/generateDetailsChart",true);}$(document).on("change",".pct-dropdown",function(){if($(this).val()===""){if($(this).attr("id")=="newPropertyState"){$("#newPropertyCounty").find("option").remove().end().append('<option value="">Select County</option>').val("").addClass("disabledSelBox").attr("disabled","disabled");}$(this).addClass("default-value");}else{if($(this).attr("id")=="newPropertyState"){$("#newPropertyCounty").removeClass("disabledSelBox").removeAttr("disabled").hide();$("#newPropertyCountyLoading").show();populateCounties(this.value,"newProperty","",function(){$("#newPropertyCounty").show();$("#newPropertyCountyLoading").hide();});}$(this).removeClass("default-value");}setSessionTimer();});$(document).on("change","input#totalExistingMortgageBalance, input#totalCurrentMonthlyPayment, input#currentInterestRate, select#newPropertyState ",function(e){$("#initManualCustomerInfoEntry").val("true");setSessionTimer();});$(document).on("click","#c28lightbox .start-over",function(evt){c2tClickEvent("PCT","LoanDetails","StartOver","BUTTON");if(confirm("Are you sure you want to start over? Click OK to clear all information and results. Click Cancel to keep your results.")==true){window.location.href="/mortgage/rates/compare-loans/";}setSessionTimer();});$(document).on("click","#c28lightbox .c28cancel",function(evt){if($("#c28lightbox div.edit-container form#topbarEmail").length>0){c2tClickEvent("PCT","Email","Cancel","BUTTON");}else{c2tClickEvent("PCT","AccountDetails","Cancel","BUTTON");}setSessionTimer();});$("#sortResult").on("change",function(evt){if($(this).val()!=""){$(this).closest("form").submit();}setSessionTimer();});$(document).on("blur","#currentInterestRate.percentage",function(e){if($(this).val()==""){return;}$(this).val(parseFloat($(this).val()).toFixed(3));setSessionTimer();});$(document).on("submit","form",function(evt){$("input[type='submit']").prop("disabled",true);setSessionTimer();});$(document).on("submit","#initialForm, #editLoanDetailForm, #topbarEmail",function(evt){showLoadingForProcessing();clearErrorMarkers();setSessionTimer();var jsonObj={data:{invalidFields:[]}};$('input[type="text"],input[type="email"], select',this).each(function(i,el){var $this=$(this);if($this.hasClass("required")===true){if($this.val()==""){jsonObj.data.invalidFields[jsonObj.data.invalidFields.length]=$this.attr("id");}else{if($this.attr("data-inputType")=="email"){if(!isValidEmail($this.val())){jsonObj.data.invalidFields[jsonObj.data.invalidFields.length]=$this.attr("id");}}}}if($this.attr("placeholder")){var isFloatScenario=false;var minimum=0;var maximum=999999999;var matches=$this.attr("placeholder").match(/^([\d,]+) - ([\d,]+)%?$/);if(evt.target.id!="topbarEmail"&&$this.attr("placeholder")!="undefined"){if($(this).attr("id")!="newAnnualRealEstateTaxesPercent"&&$(this).attr("id")!="currentInterestRate"){$(this).val(formatCurrency($this.val(),true));}}if(matches===null){matches=$this.attr("placeholder").match(/^([0-9]*[.][0-9]+) - ([0-9]*[.][0-9]+)%?$/);isFloatScenario=true;}if(matches!=null&&Array.isArray(matches)===true){if(!isFloatScenario){minimum=matches[1].replace(/\D/g,"");maximum=matches[2].replace(/\D/g,"");}else{minimum=parseFloat(matches[1]);maximum=parseFloat(matches[2]);}var floatVal=parseFloat($this.val().replace(/[^0-9.]/g,""));if(floatVal>maximum||floatVal<minimum){jsonObj.data.invalidFields[jsonObj.data.invalidFields.length]=$this.attr("id");}}}});if(jsonObj.data.invalidFields.length>0){jsonObj.status="error";jsonObj.errorMessage="Please correct the highlighted information below.";handleAjaxError(jsonObj);}else{var targetForm=$(evt.target);switch(targetForm.attr("id")){case"initialForm":return true;break;case"topbarEmail":evt.preventDefault();processEmailRequest(targetForm[0]);break;case"editLoanDetailForm":evt.preventDefault();updateLoanDetails(targetForm[0]);break;}}return false;});setSessionTimer();var sortResultsToolTip=function(){if($(".sort-tooltip").length){var elems=document.querySelector("a.sort-tooltip");var curClass=$(".sort-tooltip").attr("class");var windowHeight=$(window).height();var windowWidth=$(window).width();var offsetVal=elems.getBoundingClientRect();var left=offsetVal.left;var top=offsetVal.top;var linkHeight=$("."+curClass).height();var bottom=windowHeight-top-linkHeight;var tooltiph=$("#"+curClass).height();var elemsOffset=$(".sort-tooltip").offset();if(top>bottom){var xPos=elemsOffset.left-linkHeight;var yPos=elemsOffset.top-tooltiph-55;$("#"+curClass).css("top",yPos+"px");$("#"+curClass).css("left",xPos+"px");$("#"+curClass).find(".c29hook").addClass("bottom").removeClass("top");}else{var xPos=elemsOffset.left-linkHeight;$("#"+curClass).css("left",xPos+"px");$("#"+curClass).css("top","auto");$("#"+curClass).find(".c29hook").addClass("top").removeClass("bottom");}}};$(".sort-content").hide();$(".sort-tooltip").mouseenter(function(){sortResultsToolTip();$(".sort-content").fadeIn().attr({"tabindex":-1,"aria-hidden":false});}).mouseleave(function(){$(".sort-content").fadeOut().attr("aria-hidden",true).removeAttr("tabindex");});$(".sort-tooltip").bind("keydown",function(evt){if(evt.type=="keydown"&&evt.keyCode==13){evt.preventDefault();sortResultsToolTip();$(".sort-content").fadeIn().attr({"tabindex":-1,"aria-hidden":false}).focus();}});$(".sort-content .c29close a").on("click",function(e){e.preventDefault();$(this).parents(".sort-content").hide();$(".sort-content").fadeOut().attr("aria-hidden",true).removeAttr("tabindex");$(".sort-tooltip").focus();});});function initializeLightboxSetup(){if($("#messageBox").length>0){if($("#messageBox:eq(0)").is(":hidden")===false){$("#messageBox:eq(0)").removeAttr("id").addClass("mainPageMessageBox isVisibleMadeHidden").hide().attr("aria-hidden","true");}else{$("#messageBox:eq(0)").removeAttr("id").addClass("mainPageMessageBox");}}}function restoreLightboxIntializeAdjustment(){if($(".mainPageMessageBox").length>0){if($(".mainPageMessageBox").hasClass("isVisibleMadeHidden")===true){$(".mainPageMessageBox").attr("id","messageBox").removeClass("mainPageMessageBox isVisibleMadeHidden").show().attr("aria-hidden","false");}else{$(".mainPageMessageBox").attr("id","messageBox").removeClass("mainPageMessageBox");}}}function loadChart(url,noDataNeeded){var chkBoxArray=[];$("#compareResultsList input[name=pctId]:checked").each(function(){chkBoxArray.push("pctId="+$(this).val());});$.ajax({"type":"POST","url":url,"data":((typeof noDataNeeded!=="undefined")?"pctId="+loadChartId:chkBoxArray.join("&")),"beforeSend":function(xhr){showLoadingForProcessing();},"success":function(data){try{generateChart(data);}catch(err){Utility.ajaxLog(err);}},"error":function(xhr,code,status){Utility.ajaxLog({"message":"AJAX request to "+url+" failed with: "+code+" "+xhr.status+" "+xhr.statusText});noResults(true);}}).always(function(data,textStatus,errorThrown){clearLoadingAfterProcessing();});}function fillArray(value,len){var arr=[];for(var i=0;i<len;i++){arr.push(value);}return arr;}function doInterestRateChart(dataArr,contElemPos,adjustWidths){var tooltips=[];var formattedData=[{showInLegend:false,data:[]},{showInLegend:false,data:[]}];var pairedCounter=0;var unpairedCounter=0;var colorCounter=0,isPaired=false,wasPaired=true,anyPaired=false,colors=["#007337","#66AB87","#4D3B65","#9488A3","#0095C8","#66BFDE","#8F9092"];var elem=$("#interestContainer"+contElemPos);var optionsInterestRate={chart:{type:"column"},credits:{enabled:false},title:{align:"left",text:"Interest Rate"},plotOptions:{series:{animation:false,pointPadding:0,pointRange:0,borderWidth:0,events:{legendItemClick:function(){return false;}}}},legend:{x:0,layout:"vertical",align:"right",verticalAlign:"middle",padding:3,itemMarginTop:5,useHTML:false,itemStyle:{fontWeight:"normal",width:250}},tooltip:{style:{width:400},formatter:function(){var seriesIndex=parseInt(this.series.name.replace("Series ",""))-1;
return tooltips[this.key][seriesIndex];return this.key+" <b>"+Highcharts.numberFormat(this.y,3)+"%</b>";}},xAxis:{labels:{enabled:false},tickWidth:0},yAxis:{labels:{format:"{value}%"},lineWidth:1,lineColor:"#CCC",gridLineWidth:0,tickColor:"#CCC",tickLength:10,tickWidth:1,tickPosition:"inside",plotLines:[{color:"#CCC",width:1,value:0}],title:null},series:[]};var legendContainer="";optionsInterestRate.series=[];$.each(dataArr,function(key,value){switch(key){case"nstackData":var data=value;$.each(data,function(idx,obj){var barData={},legendData={};if(obj.data===null){legendData.name=obj.name+" <b>Not Applicable</b>";legendContainer+='<div class="chartLegend">'+this.name+"  <b>Not Applicable</b></div>";}else{legendData.name=obj.name+" <b>"+Highcharts.numberFormat(obj.data,3)+"%</b>";legendContainer+='<div class="chartLegend">'+this.name+"  <b>"+Highcharts.numberFormat(obj.data,3)+"%</b></div>";}legendData.name=legendData.name.replace(/^(&nbsp;|<br>|<br \/>)/g,"");isPaired=(obj.name.search(/^paired with/)!==-1);if(isPaired){if(typeof tooltips[unpairedCounter]==="undefined"&&Array.isArray(tooltips[unpairedCounter])===false){pairedCounter--;}tooltips[pairedCounter].push(legendData.name);pairedCounter++;wasPaired=true;anyPaired=true;}else{if(typeof tooltips[unpairedCounter]==="undefined"&&Array.isArray(tooltips[unpairedCounter])===false){tooltips[unpairedCounter]=[];pairedCounter++;}tooltips[unpairedCounter].push(legendData.name);unpairedCounter++;if(!wasPaired){colorCounter++;if(adjustWidths){formattedData[1].data.push(formattedData[0].data[formattedData[0].data.length-1]);}else{formattedData[1].data.push({y:0});}}wasPaired=false;}legendData.color=colors[colorCounter];barData.y=obj.data;barData.color=colors[colorCounter];if(isPaired){formattedData[1].data.push(barData);}else{formattedData[0].data.push(barData);}formattedData.push(legendData);colorCounter++;});break;case"caption":break;case"title":optionsInterestRate.title.text=value;break;}});if(adjustWidths){if(!isPaired&&!wasPaired){formattedData[1].data.push(formattedData[0].data[formattedData[0].data.length-1]);}}if(!anyPaired){$.each(formattedData,function(idx,obj){if(idx<=1){return true;}obj.name=obj.name.replace(/(<br>)+$/,"");});}optionsInterestRate.series=formattedData;optionsInterestRate.plotOptions.series.pointRange=formattedData[0].data.length-1;$(elem).highcharts(optionsInterestRate);$("svg",elem).attr({"alt":optionsInterestRate.title.text,"aria-label":optionsInterestRate.title.text});$("<div class='ui-hidden-accessible'  aria-hidden='false'>"+legendContainer+"</div>").appendTo(elem);}function doMonthlyPaymentChart(dataArr,contElemPos){var tooltips=[];var formattedData=[{showInLegend:false,data:[]}];var xCounter=0,colorCounter=0,isPaired,wasPaired=true,anyPaired=false,colors=["#007337","#66AB87","#4D3B65","#9488A3","#0095C8","#66BFDE","#8F9092"];var elem=$("#monthlyContainer"+contElemPos);var optionsMonthlyPayment={chart:{type:"column"},credits:{enabled:false},title:{align:"left",text:"Monthly Payment"},plotOptions:{column:{stacking:"normal",pointPadding:0,events:{legendItemClick:function(){return false;}}},series:{animation:false}},legend:{x:0,layout:"vertical",align:"right",verticalAlign:"middle",padding:3,itemMarginTop:5,useHTML:false,itemStyle:{fontWeight:"normal",width:250}},tooltip:{style:{width:400},formatter:function(){return tooltips[this.point.index];if(this.y>=0){return this.key+" <b>$"+Highcharts.numberFormat(this.y,0,"",",")+"</b>";}else{return this.key+" <b>-$"+Highcharts.numberFormat(Math.abs(this.y),0,"",",")+"</b>";}}},xAxis:{labels:{enabled:false},tickWidth:0},yAxis:{labels:{format:"${value}",formatter:function(){return"$"+this.value.toString().replace(/000$/,"K");}},tickInterval:1000,lineWidth:1,lineColor:"#CCC",gridLineWidth:0,tickColor:"#CCC",tickLength:10,tickWidth:1,tickPosition:"inside",plotLines:[{color:"#CCC",width:1,value:0}],title:null},series:[]};var legendContainer="";optionsMonthlyPayment.series=[];$.each(dataArr,function(key,value){switch(key){case"nstackData":var data=value;$.each(data,function(idx,obj){var barData={},legendData={};if(obj.data===null){legendData.name=obj.name+" <b>Not Applicable</b>";legendContainer+='<div class="chartLegend">'+this.name+"  <b>Not Applicable</b></div>";}else{if(obj.data>=0){legendData.name=obj.name+" <b>$"+Highcharts.numberFormat(obj.data,0,"",",")+"</b>";legendContainer+='<div class="chartLegend">'+this.name+"  <b>$"+Highcharts.numberFormat(obj.data,0,"",",")+"</b></div>";}else{legendData.name=obj.name+" <b>-$"+Highcharts.numberFormat(Math.abs(obj.data),0,"",",")+"</b>";legendContainer+='<div class="chartLegend">'+this.name+"  <b>-$"+Highcharts.numberFormat(Math.abs(obj.data),0,"",",")+"</b></div>";}}legendData.name=legendData.name.replace(/^(&nbsp;|<br>|<br \/>)/g,"");tooltips.push(legendData.name);isPaired=(obj.name.search(/^paired with/)!==-1);if(isPaired){wasPaired=true;anyPaired=true;}else{xCounter++;if(!wasPaired){colorCounter++;}wasPaired=false;}legendData.color=colors[colorCounter];barData.x=xCounter;barData.y=obj.data;barData.color=colors[colorCounter];formattedData[0].data.push(barData);formattedData.push(legendData);colorCounter++;});break;case"caption":break;case"title":optionsMonthlyPayment.title.text=value;break;}});if(!anyPaired){$.each(formattedData,function(idx,obj){if(idx===0){return true;}obj.name=obj.name.replace(/(<br>)+$/,"");});}optionsMonthlyPayment.series=formattedData;$(elem).highcharts(optionsMonthlyPayment);$("svg",elem).attr({"alt":optionsMonthlyPayment.title.text,"aria-label":optionsMonthlyPayment.title.text});$("<div class='ui-hidden-accessible'  aria-hidden='false'>"+legendContainer+"</div>").appendTo(elem);}function generateChart(jsonResp){var dataFormatType="currency";var legendContainer={pie:"",nstack:""};var tooltipDataFormatType=[];var optionspie={chart:{renderTo:"#pieContainer",plotBackgroundColor:null,plotBorderWidth:0,plotShadow:false,},colors:["#007337","#66AB87","#4D3B65","#9488A3","#0095C8","#66BFDE","#8F9092"],title:{text:"Monthly Breakdown",align:"left",x:-10},tooltip:{style:{width:400},formatter:function(){if(tooltipDataFormatType[$("a.cControl.cActiveControl").attr("data-control-pos")]=="currency"){if(this.y>=0){return this.key+" <b>$"+Highcharts.numberFormat(this.y,0,"",",")+"</b>";}else{return this.key+" <b>-$"+Highcharts.numberFormat(Math.abs(this.y),0,"",",")+"</b>";}}else{return this.key+" <b>"+Highcharts.numberFormat(this.y,3)+"%</b>";}}},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:false},showInLegend:true,point:{events:{legendItemClick:function(e){e.preventDefault();}}}}},legend:{enabled:true,layout:"vertical",align:"right",verticalAlign:"middle",padding:3,itemMarginTop:5,itemStyle:{fontWeight:"normal",width:250},labelFormatter:function(){var a;if(dataFormatType=="currency"){if(this.y>=0){a=this.name+"  <b>$"+Highcharts.numberFormat(this.y,0,"",",")+"</b>";legendContainer.pie+='<div class="chartLegend">'+this.name+"  <b>$"+Highcharts.numberFormat(this.y,0,"",",")+"</b></div>";}else{a=this.name+"  <b>-$"+Highcharts.numberFormat(Math.abs(this.y),0,"",",")+"</b>";legendContainer.pie+='<div class="chartLegend">'+this.name+"  <b>-$"+Highcharts.numberFormat(Math.abs(this.y),0,"",",")+"</b></div>";}}else{a=this.name+"  <b>$"+Highcharts.numberFormat(this.y,3)+"%</b>";legendContainer.pie+='<div class="chartLegend">'+this.name+"  <b>$"+Highcharts.numberFormat(this.y,3)+"%</b></div>";}a=a.replace(/^(&nbsp;|<br>|<br \/>)/g,"");return a;}},xAxix:{label:{enabled:false}},yAxix:{labels:{enabled:false},title:null},credits:{enabled:false},series:[{type:"pie",name:"Monthly Breakdown",data:[]}]};var optionsnstack={chart:{type:"column",renderTo:"#negativeStackedContainer",plotBackgroundColor:null,plotBorderWidth:0,plotShadow:false,},colors:["#007337","#66AB87","#4D3B65","#9488A3","#0095C8","#66BFDE","#8F9092"],title:{text:"Monthly Payment",align:"left",x:-10},tooltip:{style:{width:400},formatter:function(){if(tooltipDataFormatType[$("a.cControl.cActiveControl").attr("data-control-pos")]=="currency"){if(this.y>=0){return this.series.name+": <b>$"+Highcharts.numberFormat(this.y,0,"",",")+"</b>";
}else{return this.series.name+": <b>-$"+Highcharts.numberFormat(Math.abs(this.y),0,"",",")+"</b>";}}else{return this.series.name+": <b>"+Highcharts.numberFormat(this.y,3)+"%</b>";}}},credits:{enabled:false},xAxis:{lineWidth:0,tickWidth:0,tickLineWidth:0,labels:{enabled:false,formatter:function(){return"";}}},yAxis:{lineWidth:1,lineColor:"#CCC",gridLineWidth:0,tickColor:"#CCC",tickLength:10,tickWidth:1,tickPosition:"inside",plotLines:[{color:"#CCC",width:1,value:0}],title:null},legend:{enabled:true,layout:"vertical",align:"right",verticalAlign:"middle",padding:3,itemMarginTop:5,itemStyle:{fontWeight:"normal",width:250},labelFormatter:function(){var t=this.chart.options.series;var pointVal=t[this._i].data[this._i];var a;if(pointVal===null){a=this.name+" <b>Not Applicable</b>";legendContainer.nstack+='<div class="chartLegend" >'+this.name+" <b>Not Applicable</b></div>";}else{if(dataFormatType=="currency"){if(pointVal>=0){a=this.name+" <b>$"+Highcharts.numberFormat(pointVal,0,"",",")+"</b>";legendContainer.nstack+='<div class="chartLegend" >'+this.name+" <b>$"+Highcharts.numberFormat(pointVal,0,"",",")+"</b></div>";}else{a=this.name+" <b>-$"+Highcharts.numberFormat(Math.abs(pointVal),0,"",",")+"</b>";legendContainer.nstack+='<div class="chartLegend" >'+this.name+" <b>-$"+Highcharts.numberFormat(Math.abs(pointVal),0,"",",")+"</b></div>";}}else{a=this.name+" <b>"+Highcharts.numberFormat(pointVal,3)+"%</b>";legendContainer.nstack+='<div class="chartLegend" >'+this.name+" <b>"+Highcharts.numberFormat(pointVal,3)+"%</b></div>";}}a=a.replace(/^(&nbsp;|<br>|<br \/>)/g,"");return a;}},plotOptions:{column:{grouping:false,pointPadding:0.2,borderWidth:0,events:{legendItemClick:function(){return false;}}},showInLegend:true},series:[]};var jsonObj=untaintAndParse(jsonResp);if(hasError(jsonObj)){handleAjaxError(jsonObj);return;}$("#slidesContainer").empty();var data=jsonObj.data;var chartCounter=0;$.each(data,function(k,v){if(Array.isArray(v)===true){if(k=="chartPie"){for(i=0;i<v.length;i++){legendContainer.pie="";$("#slidesContainer").append("<div class='slide' data-control-pos='"+chartCounter+"' aria-hidden='true'><div id='pieContainer"+[i]+"' style='margin: 0;'></div></div>");optionspie.series[0].data=[];$.each(v[i],function(key,value){switch(key){case"pieData":$.each(value,function(dk,dv){optionspie.series[0].data[dk]=dv;if(dv.y!==null&&parseFloat(dv.y)===0){optionspie.series[0].data[dk]=$.extend({"color":"#FFFFFF"},dv);}});break;case"caption":break;case"title":optionspie.title.text=value;break;case"formatType":dataFormatType=value;tooltipDataFormatType[chartCounter]=value;break;}});chartCounter++;$("#pieContainer"+[i]).highcharts(optionspie);$("#pieContainer"+i+" svg").attr({"alt":optionspie.title.text,"aria-label":optionspie.title.text});$("<div class='ui-hidden-accessible'  aria-hidden='false'>"+legendContainer.pie+"</div>").appendTo("#pieContainer"+[i]);}}else{if(k=="nstack"||k=="simoClosingStack"){for(i=0;i<v.length;i++){legendContainer.nstack="";$("#slidesContainer").append("<div class='slide' data-control-pos='"+chartCounter+"' aria-hidden='true'><div id='negativeStackedContainer"+[i+1]+"' style='margin: 0;'></div></div>");optionsnstack.series=[];$.each(v[i],function(key,value){switch(key){case"nstackData":var arr_data=[];var pevNegVal=0,dataValParsed=0,pevPosVal=0,isDataItemNull=false;$.each(value,function(dk,dv){if(dv.data===null){isDataItemNull=true;}arr_data=fillArray(null,value.length);arr_data[dk]=dv.data;dv.data=arr_data;optionsnstack.series[dk]=dv;if(isDataItemNull===true){optionsnstack.series[dk]=$.extend({"color":"#FFFFFF"},dv);}$.each(dv.data,function(index,elem){dataValParsed=parseFloat(elem);if(elem!==null&&dataValParsed===0){optionsnstack.series[dk]=$.extend({"color":"#FFFFFF"},dv);}else{if(elem!==null&&dataValParsed<0){if(pevNegVal>dataValParsed){pevNegVal=dataValParsed;}optionsnstack.yAxis.min=pevNegVal-1;}else{if(elem!==null&&dataValParsed>0){if(pevPosVal<dataValParsed){pevPosVal=dataValParsed;}optionsnstack.yAxis.max=pevPosVal+1;}}}});});break;case"caption":break;case"title":optionsnstack.title.text=value;break;case"formatType":dataFormatType=value;tooltipDataFormatType[chartCounter]=value;break;}});chartCounter++;$("#negativeStackedContainer"+[i+1]).highcharts(optionsnstack);$("#negativeStackedContainer"+[i+1]+" svg").attr({"alt":optionsnstack.title.text,"aria-label":optionsnstack.title.text});$("<div class='ui-hidden-accessible' aria-hidden='false'>"+legendContainer.nstack+"</div>").appendTo("#negativeStackedContainer"+[i+1]);}}else{if(k=="rateStack"){for(i=0;i<v.length;i++){$("#slidesContainer").append("<div class='slide' data-control-pos='"+chartCounter+"' aria-hidden='true'><div id='interestContainer"+[i+1]+"' style='margin: 0;'></div><div class='caption' id='captionstack"+[i]+"'></div></div>");doInterestRateChart(v[i],i+1);chartCounter++;}}else{if(k=="paymentStack"){for(i=0;i<v.length;i++){$("#slidesContainer").append("<div class='slide' data-control-pos='"+chartCounter+"' aria-hidden='true'><div id='monthlyContainer"+[i+1]+"' style='margin: 0;'></div><div class='caption' id='captionstack"+[i]+"'></div></div>");doMonthlyPaymentChart(v[i],i+1);chartCounter++;}}}}}}});try{chartSlider();$("svg .highcharts-axis-labels text, svg .highcharts-legend .highcharts-legend-item text").attr("aria-hidden","true");}catch(err){Utility.ajaxLog(err);}$(".highcharts-container").each(function(si){svgTitle[si]="";svgTitle[si]+=$(" .highcharts-title",this).text();$(" .highcharts-title",this).show();});$("#chartTitle").text(svgTitle[0]);$("#slideshow").show();}var chartSlider=function(){var currentPosition=0;var slideWidth=100;var slides=$(".slide");var numberOfSlides=slides.length;$("#slidesContainer").css("overflow","hidden");slides.wrapAll('<div id="slideInner" style="overflow:hidden;"></div>').css({"float":"left"});$("#slideInner").css("width",(slideWidth*numberOfSlides)+"%");$("div.circleControlContainer").remove();var appndHtml='<div class="circleControlContainer">';if(numberOfSlides>1){for(var i=0;i<numberOfSlides;i++){appndHtml+='<a  href="javascript:void(0);" class="cControl cActiveControl" data-control-pos="'+i+'"><span class="ui-hidden-accessible">Chart '+(i+1)+"</span>&nbsp;</a>";}appndHtml+="</div>";$("#slideshow").append(appndHtml);manageControls(currentPosition);var textAppend="<span class='sr-only'>Selected</span>";if($(".cControl").hasClass("cActiveControl")){$(".cControl.cActiveControl").prepend(textAppend);}$(".cControl").on("click keypress",function(){if(!$(this).hasClass("cActiveControl")){$(this).prepend(textAppend);var txtSelect=$(this).siblings(".cControl").find('.sr-only:contains("Selected")');txtSelect.remove();}});}$("div.slide:eq("+currentPosition+")").attr("aria-hidden","false");if(typeof chartLoad==="undefined"){$("#slidesContainer").attr("tabindex","0").focus();}$(".control").on("click",function(e){e.preventDefault();currentPosition=($(this).attr("id")=="rightControl")?currentPosition+1:currentPosition-1;manageControls(currentPosition);sliderAnimateReposition(currentPosition);setSessionTimer();});function manageControls(position){$("#chartTitle").text(svgTitle[position]);if(position==0){$("#leftControl").css("visibility","hidden");}else{$("#leftControl").css("visibility","visible");}if(position==numberOfSlides-1){$("#rightControl").css("visibility","hidden");}else{$("#rightControl").css("visibility","visible");}$(".cControl").removeClass("cActiveControl");$(".cControl[data-control-pos='"+position+"']").addClass("cActiveControl");}function sliderAnimateReposition(curPosition){$("#slideInner").animate({"marginLeft":(slideWidth*(-curPosition))+"%"});$("div.slide").attr("aria-hidden","true").removeAttr("tabindex");$("div.slide:eq("+curPosition+")").attr("aria-hidden","false");$("#slidesContainer").attr("tabindex","0").focus();}$(".cControl").on("click",function(e){e.preventDefault();currentPosition=$(this).data("controlPos");manageControls(currentPosition);sliderAnimateReposition(currentPosition);setSessionTimer();});$(".slide").each(function(){var hammerSwipeRightTime=new Hammer(this,{direction:Hammer.DIRECTION_RIGHT,threshold:5,preventDefault:true,domEvents:true});
hammerSwipeRightTime.on("panright swiperight",function(ev){currentPosition=parseInt($(ev.target).closest(".slide").attr("data-control-pos"));var currentIconPos=parseInt($(".cActiveControl").attr("data-control-pos"));if(currentPosition===currentIconPos){currentPosition=((currentPosition-1)<0?0:currentPosition-1);manageControls(currentPosition);sliderAnimateReposition(currentPosition);setSessionTimer();}});var hammerSwipeLeftTime=new Hammer(this,{direction:Hammer.DIRECTION_LEFT,threshold:5,preventDefault:true,domEvents:true});hammerSwipeLeftTime.on("panleft swipeleft",function(ev){currentPosition=parseInt($(ev.target).closest(".slide").attr("data-control-pos"));var currentIconPos=parseInt($(".cActiveControl").attr("data-control-pos"));if(currentPosition===currentIconPos){currentPosition=((currentPosition+1)>=numberOfSlides?numberOfSlides-1:currentPosition+1);manageControls(currentPosition);sliderAnimateReposition(currentPosition);setSessionTimer();}});});};$(function(){function SVGElementor(tag){return document.createElementNS("http://www.w3.org/2000/svg",tag);}function prependChartDataTable(chart,containerId){var dtTblHtml="";$.each(chart.series,function(ind,seriesData){$.each(seriesData.data,function(actvPt,pointData){if(seriesData.type=="pie"){dtTblHtml+="<p> "+pointData.series.name+" for "+pointData.name+" is "+pointData.y+"</p>";}else{if(pointData.y!==null){dtTblHtml+="<p>"+pointData.series.name+" "+pointData.y+"</p>";}}});});$("<div />").addClass("ui-hidden-accessible").html(dtTblHtml).prependTo("#"+containerId);}});if(typeof loadUserPrefs=="object"){loadUserPrefs();}$("ul.navContent li a").on("click",function(evt){var url="";var subTabLinkObj=evt.target;var goal=$(subTabLinkObj).attr("data-tab");switch(goal){case"BuyAHome":url="/mortgage/rates/compare-loans/buy-a-home/";break;case"Refinance":url="/mortgage/rates/compare-loans/refinance/";break;case"ImproveMyHome":url="/mortgage/rates/compare-loans/improve/";break;case"ManageMyFinances":url="/mortgage/rates/compare-loans/use-funds/";break;}evt.preventDefault();$.ajax({"type":"POST","url":url,"data":"requestedTask=inputTask&goal="+goal+"&subGoal="+$(subTabLinkObj).attr("data-subtab"),"beforeSend":function(xhr){showLoadingForProcessing();},"success":function(data){try{window.location.href=url;}catch(err){Utility.ajaxLog(err);}},"error":function(xhr,code,status){Utility.ajaxLog({"message":"AJAX request to "+url+" failed with: "+code+" "+xhr.status+" "+xhr.statusText});noResults(true);}});setSessionTimer();});$(".blackBtn").on("click",function(e){e.preventDefault();$("#login_container").hide();$(".black_overlay").hide();});$("#expandCredentials").on("click",function(e){$("#credentialForm").toggle();});$(function(){window.wfOnFocusVals={};});function hasError(json){if(json&&json.redirectUrl){return json.redirectUrl;}if(json&&json.status=="error"){if(json.errorMessage){return json.errorMessage;}if(json.errorText){return json.errorText;}if(json.data&&json.data.invalidFields){return true;}}if(json&&json.status=="failed"){return true;}return false;}function clearErrorMarkers(){jQuery.each(["messageBox"],function(i,name){if($("#"+name+" .errorHeadline, #"+name+" .alertHeadline, #"+name+" .infoHeadline").length>0){$("#"+name).empty();$(".erroneous").removeClass("erroneous").removeAttr("aria-required").siblings(".append-error-message").hide();$(".error").removeClass("error");$("span.ui-hidden-accessible.errorText").remove();$("#"+name).hide({complete:function(){$(this).attr("aria-hidden","true");}});}});}function scrollToElement(elem){var gutter=10;if(typeof elem=="string"){if(elem.substr(0,1)!="#"){elem="#"+elem;}elem=$(elem);}var parent=$(window);var elemTop=parseInt(elem.offset().top,10);if(elem.parents("div.contentWrap").length){parent=$(elem.parents("div.contentWrap"));}if($("#c28lightbox #messageBox").length>0){$(".c28contentContainer").animate({scrollTop:0},"slow");}else{if(parent.scrollTop()>(elemTop-gutter)){parent.scrollTop(elemTop-gutter);}else{if((parent.scrollTop()+parent.height())<(elemTop+elem.outerHeight())){if(elem.outerHeight()>parent.height()){parent.scrollTop(elemTop-gutter);}else{parent.scrollTop((elemTop+elem.outerHeight()+gutter)-parent.height());}}}}}function untaintAndParse(str){if(str.substr(0,100).search(/for *\(;;/)==-1){Utility.ajaxLog({"message":"Expected JSON result but got: "+str.substr(0,100)+"..."});return str;}try{str=str.replace(/^\s*for *\(;;\) *;?\s*/,"");str=str.replace(/^\s*\/\*\s*\w+%\s+\{/,"{").replace(/\}\s+%\w+\s*\*\/\s*$/,"}");return jQuery.parseJSON(str);}catch(err){Utility.ajaxLog(err);}}function showMessageBox(level,message){var levels={"error":"error","red":"error","warning":"alert","alert":"alert","yellow":"alert","info":"informational","green":"informational"};var mbox=$("#messageBox");mbox.empty();if(message instanceof Array){var ul=mbox.append("<ul></ul>");for(var i=0;i<message.length;i++){var li=document.createElement("li");$(li).append(message[i]);$("#messageBox ul").append(li);}}else{if(message.search(/\n/)!=-1){message="<p>"+message.split(/\n/).join("</p><p>")+"</p>";}mbox.append('<div class="'+level+'Headline"><span class="ui-hidden-accessible"> '+level+" </span>"+message+"</div>");if(arguments.length>2){var ul=mbox.append("<ul>");for(var i=2;i<arguments.length;i++){$(ul).append("<li>"+arguments[i]+"</li>");}}}mbox.show({complete:function(){$(this).attr({"aria-hidden":"false","tabindex":"0"}).focus();}});if(mbox.length>0){scrollToElement(mbox);}}function populateCounties(state,target_id,defaultSelectedOption,callBack){if(!state){return;}var formData="state="+$("#"+target_id+"State").val();if($("#siteSuffix").length){formData+="&siteSuffix="+$("#siteSuffix").val();}var url="/as/forms/common/counties";$.ajax({"type":"get","url":url,"data":formData,"success":function(obj){obj=untaintAndParse(obj);try{if(hasError(obj)||!obj.data.counties){countyLookupFailure(target_id,obj.errorMessage);return false;}var data=obj.data.counties||[];if(Array.isArray(data)===true&&data.length>0){appendToSelect(truncateSelect(target_id+"County",1),data,defaultSelectedOption);if(state=="AK"){$("#"+target_id+"County").css("width","16em");$("#"+target_id+"County").parents("div.chunk").css("width","18em");}else{$("#"+target_id+"County").css("width","10.5em");$("#"+target_id+"County").parents("div.chunk").css("width","15em");}$("#"+target_id+"County").removeAttr("disabled").removeClass("disabledSelBox");}if(document.activeElement){var aTag=document.activeElement.tagName;if(aTag=="BODY"||aTag=="DIV"){$("#"+target_id+"County").focus();}}}catch(err){Utility.ajaxLog(err);}if(typeof callBack=="function"){callBack();}},"error":function(xhr,code,status){Utility.ajaxLog({"message":"AJAX request to "+url+" failed with: "+code+" "+xhr.status+" "+xhr.statusText});countyLookupFailure(target_id,"Oops, couldn't get counties.");if(typeof callBack=="function"){callBack();}}});setSessionTimer();}function noResults(suppressRedirect){$("#loadingOverlay").hide();$("#loadingDialog").hide();if(suppressRedirect){return;}}function countyLookupFailure(target_id,msg){$("#"+target_id+"CountyLoading").hide();$("#"+target_id+"County").replaceWith('<div id="'+target_id+'County">'+msg+"</div>");$("#"+target_id+"County").show();}function appendToSelect(elem,data,defaultSelectedOption){if(typeof elem=="string"){elem=document.getElementById(elem);}var opts=elem.options;var key="";for(var i=0;i<data.length;i++){key=data[i];if(typeof defaultSelectedOption!="undefined"&&defaultSelectedOption==key){opts[opts.length]=new Option(data[i],key,false,true);}else{opts[opts.length]=new Option(data[i],key,false,false);}}}var updateAltTextAndTitleText=function(){$("a, img").not(".c62toggle").each(function(){if(!!$(this).attr("title")&&!$(this).data("newWindowFixed")){var title=$(this).attr("title");title=title.replace(/\./g,"");title=title.replace(/New window/g,"");title=$.trim(title)+". New window.";$(this).attr("title",title);$(this).data("newWindowFixed",true);}if(!!$(this).attr("alt")&&!$(this).data("newWindowFixed")){var alt=$(this).attr("alt");
alt=alt.replace(/\./g,"");alt=alt.replace(/New window/g,"");alt=$.trim(alt)+". New window.";$(this).attr("alt",alt);$(this).data("newWindowFixed",true);}});};function setSessionTimer(){clearTimeout(window.sessionTimerWarning);clearTimeout(window.sessionTimerTimedout);var when=new Date();when.setMinutes(when.getMinutes()+15);window.sessionTimerWarning=setTimeout(function(){showTimeoutPopup(when);},13*60*1000);window.sessionTimerTimedout=setTimeout(function(){showTimeoutPage();},15*60*1000);}function showTimeoutPage(){window.location.href="/as/global/session-timeout";}function showTimeoutPopup(expTime){var customOptions={lbOption:{noCloseButton:true},triggerLinkId:"sessionTimeoutTrigger",popupContentId:"sessionTimeoutMsgContent",triggerLinkText:"Session TimeOut Trigger",popupContentHtml:"<div id='content' class='470x170'><h3>Do you want to continue your session?</h3> <div class='editSubTitle'>For security reasons, your session will time out at "+getFormattedTime(expTime)+' unless you continue.</div><div class="btnContainer"><button class="update primary" id="continueSessionBtn" type="button">Continue Session</button></div></div>',bindEventsToButton:[{buttonId:"continueSessionBtn",handlerFunc:continueUserSession,exitPopupAfterProcessing:true}]};showCustomLightBoxPopup(customOptions);}function getFormattedTime(dt){var hr=dt.getHours();var meridiem="AM";if(hr>11){meridiem="PM";}if(hr>12){hr-=12;}if(hr<1){hr=12;}var min=""+dt.getMinutes();if(min.length==1){min="0"+min;}var tz=dt.toString().match(/((Eastern|Central|Mountain|Pacific) (Daylight|Standard) Time|[ECMP][DS]T)/);if(tz){tz=tz[0].replace(/[a-z ]/g,"");return hr+":"+min+" "+meridiem+" "+tz;}else{return hr+":"+min+" "+meridiem;}}function continueUserSession(evt){var formData="";if($("#siteSuffix").length){formData="siteSuffix="+$("#siteSuffix").val();}var url="/as/global/session-reset";$.ajax({"type":"post","url":url,"data":formData,"success":function(data){data=untaintAndParse(data);try{if(hasError(data)){handleAjaxError(data);return;}if(data.warningMessage){showMessageBox("warning",data.warningMessage);}else{if(data.informationalMessage){showMessageBox("info",data.informationalMessage);}}}catch(err){Utility.ajaxLog(err);}},"error":function(xhr,code,status){Utility.ajaxLog({"message":"AJAX request to "+url+" failed with: "+code+" "+xhr.status+" "+xhr.statusText});}});setSessionTimer();}function clearEarlierCustomPopup(trigerElementId,popupContentId){$("#"+trigerElementId).remove();$("#"+popupContentId).remove();}function showCustomLightBoxPopup(customOptions){var setOptions=$.extend({},customOptions);var lightboxOptions=customOptions.lbOption||false;var customPopupBox=null;clearEarlierCustomPopup(setOptions.triggerLinkId,setOptions.popupContentId);var $popupTriggerLink=$("<a />").attr("id",setOptions.triggerLinkId).addClass("c28aLink").attr("data-lbcontentId",setOptions.popupContentId).text(setOptions.triggerLinkText);$(document.body).append($popupTriggerLink);$(document.body).append("<div id='"+setOptions.popupContentId+"'></div>");$("#"+setOptions.popupContentId).hide();$popupTriggerLink.hide();customPopupBox=new WF.Component.LightBox($popupTriggerLink[0],lightboxOptions);$("#"+setOptions.popupContentId).html(setOptions.popupContentHtml);$(document).on("click","a#"+setOptions.triggerLinkId,function(evt){$("#"+setOptions.popupContentId).html("");if(setOptions.bindEventsToButton&&typeof setOptions.bindEventsToButton!=="undefined"){$.each(setOptions.bindEventsToButton,function(i,buttonNEvents){$(document).off("click","#"+buttonNEvents.buttonId);$(document).on("click","#"+buttonNEvents.buttonId,function(evt){if(typeof buttonNEvents.handlerFunc==="function"){buttonNEvents.handlerFunc(evt);}if((buttonNEvents.exitPopupAfterProcessing&&typeof buttonNEvents.exitPopupAfterProcessing!="undefined")&&buttonNEvents.exitPopupAfterProcessing===true){customPopupBox.hide();$(document).off("click","a#"+setOptions.triggerLinkId);$(document).off("click","#"+buttonNEvents.buttonId);}});});}});$popupTriggerLink.trigger("click");$(".c29content[aria-hidden=false] .c29close a").trigger("click");return customPopupBox;}if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]";};}function showEmailResultSuccessPopup(){var customOptions={triggerLinkId:"emailSentTrigger",popupContentId:"emailSentMsgContent",triggerLinkText:"Email Sent Trigger",popupContentHtml:"<div id='content' class='400x150'><h3>Email sent</h3> <div class='editSubTitle'>Your loan details have been sent so you can review them later. If sent to anyone other than yourself, you may want to alert them that this email was sent.</div><div class='btnContainer'><a class='c28close update primary'>Close</a></div></div>"};showCustomLightBoxPopup(customOptions);}function fixLoadingOverlayPosition(){var fp=findPos(document.getElementById("loadingOverlay"));if(fp[0]===0&&fp[1]===0){return true;}$("#loadingOverlay, #loadingDialog").css("position","absolute");var windowWidth=Utility.getWindowWidth();var windowHeight=Utility.getWindowHeight();var scrollY=document.documentElement.scrollTop;var ldLeft=Math.floor(windowWidth*0.35);var ldTop=Math.floor(windowHeight*0.35+scrollY);$("#loadingDialog").css({"left":ldLeft+"px","top":ldTop+"px"});$("select").css("visibility","hidden");}function findPos(obj){var curleft=curtop=0;if(obj&&obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while(obj=obj.offsetParent);}return[curleft,curtop];}function fireC2TPCTCompletionEvent(applicationCode,subproduct,clickName,clickType){var stdOptions={"log":1,"url":window.location.href,"applicationCode":applicationCode,"eventsOrder":[{"CompletionCreator":" 1"},{"ClickCreator":"2"}],"eventStructure[ClickCreator]":applicationCode+"_"+subproduct+"_Click","eventStructure[CompletionCreator]":applicationCode+"_"+subproduct+"_Completion","headerStructure[HeaderCreator]":"header_"+applicationCode,"data[clickType]":clickType,"data[clickItemName]":clickName};WF.Utils.logC2TtoolEvent(stdOptions);}function fireC2TPCTConsiderationEvent(applicationCode,subproduct,clickName,clickType){var stdOptions={"log":1,"url":window.location.href,"applicationCode":applicationCode,"eventsOrder":[{"ConsiderationCreator":" 1"},{"ClickCreator":"2"}],"eventStructure[ClickCreator]":applicationCode+"_"+subproduct+"_Click","eventStructure[ConsiderationCreator]":applicationCode+"_"+subproduct+"_Consideration","headerStructure[HeaderCreator]":"header_"+applicationCode,"data[clickType]":clickType,"data[clickItemName]":clickName};WF.Utils.logC2TtoolEvent(stdOptions);}$(".printLink").on("click",function(e){var subProductCode;if(WF.Utils.getPageTitle().indexOf("Details")!=-1){subProductCode="ProductDetails";}else{if(WF.Utils.getPageTitle().indexOf("Results")!=-1){subProductCode="Results";}else{if(WF.Utils.getPageTitle().indexOf("Compare")!=-1){subProductCode="Goal";}else{subProductCode="Input";}}}fireC2TPCTConsiderationEvent("PCT",subProductCode,$(this).text().trim(),"LINK");});$(".firstHalf a").on("click",function(e){var subProductCode;if(WF.Utils.getPageTitle().indexOf("Details")!=-1){subProductCode="ProductDetails";}else{if(WF.Utils.getPageTitle().indexOf("Results")!=-1){subProductCode="Results";}else{if(WF.Utils.getPageTitle().indexOf("Compare")!=-1){subProductCode="Goal";}else{subProductCode="Input";}}}fireC2TPCTCompletionEvent("PCT",subProductCode,$(this).text().trim(),"BUTTON");});$(".secondHalf a").on("click",function(e){var subProductCode;if(WF.Utils.getPageTitle().indexOf("Details")!=-1){subProductCode="ProductDetails";}else{if(WF.Utils.getPageTitle().indexOf("Results")!=-1){subProductCode="Results";}else{if(WF.Utils.getPageTitle().indexOf("Compare")!=-1){subProductCode="Goal";}else{subProductCode="Input";}}}fireC2TPCTConsiderationEvent("PCT",subProductCode,$(this).text().trim(),"LINK");});$("div#impDisclosures .pctAccordion .c16 .c16header").on("click",function(e){var subProductCode;if(WF.Utils.getPageTitle().indexOf("Details")!=-1){subProductCode="ProductDetails";
}else{if(WF.Utils.getPageTitle().indexOf("Results")!=-1){subProductCode="Results";}else{if(WF.Utils.getPageTitle().indexOf("Compare")!=-1){subProductCode="Goal";}else{subProductCode="Input";}}}fireC2TPCTConsiderationEvent("PCT",subProductCode,$(this).text().trim(),"LINK");});var c2tClickEvent=function(applicationCode,subProductCode,clickName,clickType){var stdOptions={"url":window.location.href,"applicationCode":applicationCode,"eventStructure[ClickCreator]":applicationCode+"_"+subProductCode+"_Click","headerStructure[HeaderCreator]":"header_"+applicationCode,"data[clickType]":clickType,"data[clickItemName]":clickName};WF.Utils.logC2TtoolEvent(stdOptions);};function Utility(){}Utility.getWindowWidth=function(){if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth;}else{if(document.body&&document.body.clientWidth){return document.body.clientWidth;}}};Utility.getWindowHeight=function(){if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight;}else{if(document.body&&document.body.clientHeight){return document.body.clientHeight;}}};Utility.ajaxLog=function(err){var url="/as/jsLog";var query={"message":err.message,"url":window.location.href,"logType":"FATAL","detailedMessage":{}};var detailedMessage={};if(err.fileName){detailedMessage.jsFileUrl=err.fileName;}else{if(err.sourceURL){detailedMessage.jsFileUrl=err.sourceURL;}}if(err.stack){var stack=Utility.parseErrorStack(err.stack);if(stack[0]){if(stack[0].name){detailedMessage.errorFunctionName=stack[0].name;}if(stack[0].line){detailedMessage.errorLineNumber=stack[0].line;}if(!query.jsFileUrl){detailedMessage.jsFileUrl=stack[0].url;}if(stack[0].args){detailedMessage.additionalInfo="arguments: "+stack[0].args;}}if(stack[1]&&stack[1].name){detailedMessage.callingFunctionName=stack[1].name;}}else{if(arguments.callee.caller){detailedMessage.errorFunctionName=Utility.getNameFromCallee(arguments.callee.caller);if(arguments.callee.caller.caller){detailedMessage.callingFunctionName=Utility.getNameFromCallee(arguments.callee.caller.caller);}}else{detailedMessage=JSON.stringify(arguments);}}if(err.line){detailedMessage.errorLineNumber=err.line;}query.detailedMessage=JSON.stringify(detailedMessage);if($.isEmptyObject(detailedMessage)||query.detailedMessage==="{}"){query.detailedMessage="Detailed message is empty at this time";}$.ajax({type:"POST",data:JSON.stringify(query),url:url,contentType:"application/json"});};Utility.getNameFromCallee=function(callee){var hope=callee.toString().match(/^function (\w*)\(/);if(hope&&hope[1]){return hope[1];}if(callee.toString().search(/^function ?\(/)!=-1){return"[anonymous function]";}return false;};Utility.parseErrorStack=function(stack,errName){var isChrome=(stack.search(/\n +at/)!=-1);stack=stack.replace(/(\d+):\d+\)\n/g,"$1\n");var lines=stack.split(/\n(?: +at )?/);if(isChrome){lines.shift();}var ret=[];for(var i=0;i<lines.length;i++){var item={};if(isChrome){var funcname=lines[i].split(/ /).shift();}else{var funcname=lines[i].split(/\@/).shift();}var match=funcname.match(/\((.*)\)$/);if(match){item.args=match[1];funcname=funcname.substr(0,funcname.indexOf("("));}item.name=funcname;item.line=lines[i].split(/:/).pop();lines[i]=lines[i].replace(/:\d+$/,"");item.url=lines[i].split(/[\(@]/).pop();ret.push(item);}return ret;};function truncateSelect(elem,limit){if(typeof limit!="number"){limit=0;}var atts=[];for(var a in elem){atts.push(a);}atts=atts.sort();if(typeof elem=="string"){elem=document.getElementById(elem);}while(elem.options.length>limit){elem.remove(limit);}return elem;}jQuery.fn.outerHTML=function(s){return(s)?this.before(s).remove():jQuery("<p>").append(this.eq(0).clone()).html();};